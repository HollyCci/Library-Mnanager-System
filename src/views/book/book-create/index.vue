<template>
  <n-space vertical :size="16">
    <n-card title="Ê≠•È™§" :bordered="false" size="small" class="rounded-8px shadow-sm" hoverable>
      <n-space vertical>
        <t-steps :current="current" status="process" class="steps-demos-extra">
          <t-step-item title="Âõæ‰π¶" content="Êñ∞Â¢ûÂõæ‰π¶">
            <template v-if="current === 0" #extra>
              <t-button size="small" variant="base" :loading="createBookLoading" @click="handleSubmitBook">
                ‰∏ã‰∏ÄÊ≠•
              </t-button>
            </template>
          </t-step-item>
          <t-step-item title="Â∫ìÂ≠ò" content="Êñ∞Â¢ûÂ∫ìÂ≠ò">
            <template v-if="current === 1" #extra>
              <t-button size="small" variant="text" @click="current--">‰∏ä‰∏ÄÊ≠•</t-button>
              <t-button size="small" variant="base" @click="current++">‰∏ã‰∏ÄÊ≠•</t-button>
            </template>
          </t-step-item>
          <t-step-item title="ÂÆåÊàê" content="Ê∑ªÂä†ÊàêÂäü">
            <template v-if="current === 2" #extra>
              <t-button size="small" variant="text" @click="current--">‰∏ä‰∏ÄÊ≠•</t-button>
              <t-button size="small" variant="base" @click="current++">‰∏ã‰∏ÄÊ≠•</t-button>
            </template>
          </t-step-item>
        </t-steps>
      </n-space>
    </n-card>
    <n-card
      v-if="current === 0"
      title="‰π¶ÁõÆ‰ø°ÊÅØ"
      :bordered="false"
      size="small"
      class="rounded-8px shadow-sm"
      hoverable
    >
      <n-space :size="16" :wrap="false">
        <!-- Â∑¶‰æßÔºöÂõæ‰π¶Â∞ÅÈù¢ -->
        <n-space :size="16">
          <n-avatar class="mt20" :size="200" src="https://07akioni.oss-cn-beijing.aliyuncs.com/07akioni.jpeg" />
        </n-space>
        <!-- Âè≥‰æßÔºöÂõæ‰π¶‰ø°ÊÅØË°®Âçï -->
        <n-space :size="16" :wrap="false">
          <n-form ref="formRef" v-loading="formLoading" :rules="formBookRules" :inline="true" :model="formBookData">
            <!-- ‰ΩøÁî® n-grid Êù•Â∏ÉÂ±ÄË°®ÂçïÈ°π -->
            <n-grid :cols="24" :x-gap="50">
              <!-- Âõæ‰π¶ÂêçÁß∞ -->
              <n-form-item-gi :span="5" label="Âõæ‰π¶ÂêçÂ≠ó" path="title" required>
                <n-input v-model:value="formBookData.title" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶ÂêçÂ≠ó" />
              </n-form-item-gi>

              <!-- ‰ΩúËÄÖ -->
              <n-form-item-gi :span="5" label="‰ΩúËÄÖ" path="author" required>
                <n-input v-model:value="formBookData.author" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶‰ΩúËÄÖ" />
              </n-form-item-gi>

              <!-- ISBN -->
              <n-form-item-gi :span="5" label="ISBN" path="isbn" required>
                <n-input v-model:value="formBookData.isbn" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶Ê†áÂáÜÁºñÁ†Å" />
              </n-form-item-gi>

              <!-- ÂàÜÁ±ª -->
              <n-form-item-gi :span="7" label="ÂàÜÁ±ª" path="categoryId" required>
                <n-tree-select
                  v-model:value="formBookData.categoryId"
                  filterable
                  checkable
                  :options="categoryList"
                  default-expand-all
                  label-field="name"
                  key-field="id"
                  children-field="children"
                  clearable
                  placeholder="ËØ∑ÈÄâÊã©Âõæ‰π¶ÂàÜÁ±ª"
                >
                  <template #action>
                    <n-gradient-text type="info">üì£:Âõæ‰π¶ÂàÜÁ±ªËæÉÂ§öÔºåÊÇ®ÂèØ‰ª•ËæìÂÖ•Ê£ÄÁ¥¢‰ø°ÊÅØÂø´ÈÄüÊêúÁ¥¢„ÄÇ</n-gradient-text>
                  </template>
                </n-tree-select>
              </n-form-item-gi>

              <n-form-item-gi :span="5" label="Âá∫ÁâàÁ§æ" path="publisher" required>
                <n-input v-model:value="formBookData.publisher" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶Âá∫ÁâàÁ§æ" />
              </n-form-item-gi>
              <n-form-item-gi :span="5" label="Âá∫ÁâàÂú∞" path="pubCity">
                <n-input v-model:value="formBookData.pubCity" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶Âá∫ÁâàÂú∞" />
              </n-form-item-gi>
              <n-form-item-gi :span="5" label="Âá∫ÁâàÂõΩÂÆ∂" path="pubCountry">
                <n-input v-model:value="formBookData.pubCountry" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶Âá∫ÁâàÂõΩÂÆ∂Ëã±ÊñáÁº©ÂÜô" />
              </n-form-item-gi>
              <n-form-item-gi :span="7" label="‰∏ªÈ¢òËØç" path="subjectIds" required>
                <n-select
                  v-model:value="formBookData.subjectIds"
                  multiple
                  filterable
                  label-field="name"
                  value-field="id"
                  :options="subjectList"
                  placeholder="ËØ∑‰∏∫ÂÖ∂ÂàÜÈÖç‰∏ªÈ¢òËØç"
                >
                  <template #action>
                    <n-gradient-text type="info">üì¢:‰∏ªÈ¢òËØç‰ø°ÊÅØËæÉÂ§öÔºåÊÇ®ÂèØ‰ª•ËæìÂÖ•Ê£ÄÁ¥¢‰ø°ÊÅØÂø´ÈÄüÊêúÁ¥¢„ÄÇ</n-gradient-text>
                  </template>
                </n-select>
              </n-form-item-gi>
              <n-form-item-gi :span="4" label="Âá∫ÁâàÊó∂Èó¥" path="pubDate">
                <n-input-number v-model:value="formBookData.pubDate" placeholder="Âõæ‰π¶Âá∫ÁâàÊó∂Èó¥" />
              </n-form-item-gi>
              <n-form-item-gi :span="3" label="‰ª∑Ê†º" path="price" required>
                <n-input-number v-model:value="formBookData.price" :show-button="false" :min="0">
                  <template #prefix>Ôø•</template>
                </n-input-number>
              </n-form-item-gi>
              <n-form-item-gi :span="3" label="È°µÊï∞" path="pages">
                <n-input-number v-model:value="formBookData.pages" :show-button="false">
                  <template #suffix>È°µ</template>
                </n-input-number>
              </n-form-item-gi>
              <n-form-item-gi :span="5" label="Á¥¢‰π¶Âè∑" path="callNumber">
                <n-input v-model:value="formBookData.callNumber" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶Á¥¢‰π¶Âè∑" />
              </n-form-item-gi>
              <n-form-item-gi :span="7" label="‰∏≠ÂõæÂàÜÁ±ª" path="classification">
                <n-input v-model:value="formBookData.classification" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶ÊâÄÂ±û‰∏≠ÂõæÂàÜÁ±ª" />
              </n-form-item-gi>
              <n-form-item-gi :span="12" label="Êú¨‰π¶ÊëòË¶Å" path="abstracts">
                <n-input
                  v-model:value="formBookData.abstracts"
                  type="textarea"
                  maxlength="250"
                  show-count
                  :autosize="{
                    minRows: 2,
                    maxRows: 5
                  }"
                  placeholder="ËØ∑‰∫éÊ≠§Â§ÑËæìÂÖ•Âõæ‰π¶ÊëòË¶Å‰ø°ÊÅØ"
                />
              </n-form-item-gi>
              <n-form-item-gi :span="10" label="‰∏õÁºñÈ°π" path="series">
                <n-input
                  v-model:value="formBookData.series"
                  type="textarea"
                  maxlength="50"
                  show-count
                  :autosize="{
                    minRows: 2,
                    maxRows: 5
                  }"
                  placeholder="ËØ∑‰∫éÊ≠§Â§ÑËæìÂÖ•Âõæ‰π¶‰∏õÁºñÈ°π"
                />
              </n-form-item-gi>
              <n-gi :span="24">
                <div style="display: flex; justify-content: flex-end">
                  <n-button
                    v-if="isSubmit === false"
                    round
                    type="primary"
                    :loading="createBookLoading"
                    @click="handleSubmitBook"
                  >
                    Êèê‰∫§
                  </n-button>
                  <n-button
                    v-if="isSubmit === true"
                    round
                    type="primary"
                    :loading="createBookLoading"
                    @click="handleSubmitBook"
                  >
                    Êõ¥Êñ∞
                  </n-button>
                </div>
              </n-gi>
            </n-grid>
          </n-form>
        </n-space>
      </n-space>
    </n-card>

    <n-card
      v-if="current === 1"
      title="È¶ÜËóè‰ø°ÊÅØ"
      :bordered="false"
      size="small"
      class="rounded-8px shadow-sm"
      hoverable
    >
      <!-- Êñ∞Â¢ûÊåâÈíÆ -->
      <n-button plain type="primary" class="ml1 mb2" @click="openForm('create')">
        <template #icon>
          <icon-fluent:add-12-regular class="text-20px" />
        </template>
        Êñ∞Â¢û
      </n-button>

      <!-- ÂØºÂÖ•ÊåâÈíÆ -->
      <n-button plain class="ml3 mr3" type="warning" @click="handleImport">
        <template #icon>
          <icon-ep:upload class="text-20px" />
        </template>
        ÂØºÂÖ•
      </n-button>

      <!-- È¶ÜËóè‰ø°ÊÅØÊï∞ÊçÆË°®Ê†º -->
      <n-data-table
        :loading="loading"
        striped
        remote
        :single-line="false"
        :data="list"
        :row-key="rowKey"
        :columns="columns"
        :pagination="pagination"
      />
    </n-card>

    <!-- È¶ÜËóè‰ø°ÊÅØÁºñËæëÂºπÁ™ó -->
    <n-modal v-model:show="formShow" transform-origin="center">
      <n-card style="width: 600px" title="Â∫ìÂ≠ò‰ø°ÊÅØ" :bordered="false" size="huge" role="dialog" aria-modal="true">
        <!-- ÂºπÁ™óÂ§¥ÈÉ®ÔºöÂÖ≥Èó≠ÊåâÈíÆ -->
        <template #header-extra>
          <icon-line-md:close class="text-20px" @click="formStackClose" />
        </template>

        <!-- ÂºπÁ™óÂÜÖÂÆπÔºöÈ¶ÜËóè‰ø°ÊÅØÁºñËæëË°®Âçï -->
        <n-form
          ref="formStackRef"
          v-loading="formLoading"
          :model="formStackData"
          label-placement="left"
          label-width="80px"
        >
          <!-- Âõæ‰π¶ÂêçÂ≠óÂ±ïÁ§∫ -->
          <n-form-item label="Âõæ‰π¶">
            <n-input v-model:value="formBookData.title" disabled style="width: 80%" />
          </n-form-item>

          <!-- Êù°ÂΩ¢Á†ÅËæìÂÖ•Ê°Ü -->
          <n-form-item label="Êù°ÂΩ¢Á†Å" path="barCode">
            <n-input v-model:value="formStackData.barCode" placeholder="ËØ∑ËæìÂÖ•Âõæ‰π¶Êù°ÂΩ¢Á†Å" style="width: 80%" />
          </n-form-item>

          <!-- È¶ÜËóèÂú∞ÂùÄÈÄâÊã© -->
          <n-form-item label="È¶ÜËóèÂú∞ÂùÄ" path="stackId" style="width: 57%">
            <n-select
              v-model:value="formStackData.stackId"
              clearable
              placeholder="ËØ∑ÈÄâÊã©È¶ÜËóèÂú∞ÂùÄ"
              :options="stackList"
              label-field="name"
              value-field="id"
              key-field="id"
            />
          </n-form-item>

          <!-- Âõæ‰π¶Áä∂ÊÄÅÈÄâÊã© -->
          <n-form-item label="Âõæ‰π¶Áä∂ÊÄÅ" path="status" style="width: 50%">
            <n-select
              v-model:value="formStackData.status"
              clearable
              placeholder="ËØ∑ÈÄâÊã©Âõæ‰π¶Áä∂ÊÄÅ"
              :options="DictOptions"
            />
          </n-form-item>

          <!-- ËØ¶ÁªÜÂú∞ÂùÄËæìÂÖ•Ê°Ü -->
          <n-form-item label="ËØ¶ÁªÜÂú∞ÂùÄ" path="location">
            <n-input
              v-model:value="formStackData.location"
              type="textarea"
              :autosize="{
                minRows: 2,
                maxRows: 5
              }"
              placeholder="ËØ∑ËæìÂÖ•ËØ¶ÁªÜÂú∞ÂùÄ"
            />
          </n-form-item>
        </n-form>

        <!-- ÂºπÁ™óÂ∫ïÈÉ®ÊåâÈíÆ -->
        <template #footer>
          <n-space style="float: right">
            <n-button type="primary" @click="submitFrom">Á°Æ ÂÆö</n-button>
            <n-button @click="formStackClose">Âèñ Ê∂à</n-button>
          </n-space>
        </template>
      </n-card>
    </n-modal>

    <n-modal v-model:show="uploadShow" transform-origin="center" preset="dialog" title="Â∫ìÂ≠òÂØºÂÖ•">
      <!-- Êñá‰ª∂‰∏ä‰º†ÈÉ®ÂàÜ -->
      <n-upload
        ref="uploadRef"
        multiple
        :default-upload="false"
        directory-dnd
        :action="importUrl + '?updateSupport=' + updateSupport"
        :max="1"
        :headers="uploadHeaders"
        accept=".xlsx, .xls"
        :on-error="submitFormError"
        :on-finish="submitFormSuccess"
      >
        <!-- Êñá‰ª∂‰∏ä‰º†ÊãñÊãΩÂå∫Âüü -->
        <n-upload-dragger>
          <div style="margin-bottom: 12px; width: 333px">
            <n-icon size="48" :depth="3">
              <icon-line-md:upload-loop />
            </n-icon>
          </div>
          <n-text style="font-size: 16px">ÁÇπÂáªÊàñËÄÖÊãñÂä®Êñá‰ª∂Âà∞ËØ•Âå∫ÂüüÊù•‰∏ä‰º†</n-text>
        </n-upload-dragger>
      </n-upload>

      <!-- ÊòØÂê¶Êõ¥Êñ∞Â∑≤Â≠òÂú®ÁöÑÁî®Êà∑Êï∞ÊçÆÁöÑÈÄâÊã© -->
      <n-space justify="center">
        <n-checkbox v-model:checked="updateSupport" class="m2">ÊòØÂê¶Êõ¥Êñ∞Â∑≤ÁªèÂ≠òÂú®ÁöÑÁî®Êà∑Êï∞ÊçÆ</n-checkbox>
      </n-space>

      <!-- Êñá‰ª∂Ê†ºÂºèËØ¥ÊòéÂíåÊ®°Êùø‰∏ãËΩΩ -->
      <n-space justify="center">
        ‰ªÖÂÖÅËÆ∏ÂØºÂÖ•xlsx„ÄÅxlsÊ†ºÂºèÁöÑÊñá‰ª∂„ÄÇ
        <n-button text type="primary" @click="importTemplate">‰∏ãËΩΩÊ®°Êùø</n-button>
      </n-space>

      <!-- Â∫ïÈÉ®Êìç‰ΩúÊåâÈíÆ -->
      <template #action>
        <n-button type="primary" @click="submitUploadForm">Á°ÆÂÆö</n-button>
        <n-button @click="closeUploadForm">ÂèñÊ∂à</n-button>
      </template>
    </n-modal>

    <n-card v-if="current === 2" title="ÁªìÊûúÈ°µ" :bordered="false" size="small" class="rounded-8px shadow-sm" hoverable>
      <n-result status="success" title="Ê∑ªÂä†Âõæ‰π¶ÊàêÂäü" description="">
        <template #footer>
          <n-button @click="backPage">ËøîÂõûÈ¶ÜËóèÂõæ‰π¶È°µ</n-button>
        </template>
      </n-result>
    </n-card>
  </n-space>
</template>

<script setup lang="tsx">
/* eslint-disable */
import {ref, h, reactive, onMounted} from 'vue'; // ÂØºÂÖ• Vue Composition API ‰∏≠ÁöÑÂáΩÊï∞
import {NSpace, NTime, NButton, NPopconfirm} from 'naive-ui'; // ÂØºÂÖ• Naive UI ‰∏≠ÁöÑ‰∏Ä‰∫õÁªÑ‰ª∂
import type {DataTableColumns, MessageReactive, FormRules, FormInst} from 'naive-ui'; // ÂØºÂÖ• Naive UI ‰∏≠ÁöÑ‰∏Ä‰∫õÁ±ªÂûã
import {formRules} from '~/src/utils'; // ÂØºÂÖ•Ëá™ÂÆö‰πâÁöÑË°®ÂçïËßÑÂàô

const current = ref(0);

// ÂìçÂ∫îÂºèÂºïÁî®ÔºåÂ≠òÂÇ®ÂàóË°®Êï∞ÊçÆ
const list = ref([]);

// ÂìçÂ∫îÂºèÂºïÁî®ÔºåÂ≠òÂÇ®Âõæ‰π¶ÂàÜÁ±ªÂàóË°®
const categoryList = ref([]);

// ÂìçÂ∫îÂºèÂºïÁî®ÔºåÂ≠òÂÇ®‰∏ªÈ¢òËØçÂàóË°®
const subjectList = ref([]);

// ÂìçÂ∫îÂºèÂºïÁî®ÔºåÂ≠òÂÇ®È¶ÜËóèÂú∞ÂùÄÂàóË°®
const stackList = ref([]);

// Ë°®ÂçïÂä†ËΩΩÁä∂ÊÄÅ
const formLoading = ref(false); // Ë°®ÂçïÁöÑÂä†ËΩΩ‰∏≠Ôºö1Ôºâ‰øÆÊîπÊó∂ÁöÑÊï∞ÊçÆÂä†ËΩΩÔºõ2ÔºâÊèê‰∫§ÁöÑÊåâÈíÆÁ¶ÅÁî®
const formRef = ref<HTMLElement & FormInst>(); // Ë°®ÂçïÁöÑÂºïÁî®
// Ë°®ÂçïÁ±ªÂûã
const formType = ref(''); // Ë°®ÂçïÁöÑÁ±ªÂûãÔºöcreate - Êñ∞Â¢ûÔºõupdate - ‰øÆÊîπ

const isSubmit = ref(false); // ÊòØÂê¶Êèê‰∫§Ë°®Âçï

// loading
const loading = ref(false); // Êï∞ÊçÆÂä†ËΩΩ‰∏≠ÁöÑÊ†áËØÜ
const createBookLoading = ref(false); // Êèê‰∫§ÂàõÂª∫Âõæ‰π¶ÁöÑÂä†ËΩΩ‰∏≠Áä∂ÊÄÅ

const formShow = ref(false); // Ë°®ÂçïÁöÑÊòæÁ§∫Áä∂ÊÄÅÔºåÊéßÂà∂Ë°®ÂçïÁöÑÊòæÁ§∫ÂíåÈöêËóè
const pageCount = ref(0); // ÂàÜÈ°µÁöÑÊÄªÈ°µÊï∞

// ÂìçÂ∫îÂºèÂºïÁî®ÔºåÂ≠òÂÇ®Ë°®ÂçïÊï∞ÊçÆ
const formBookData = ref({
	id: undefined,
	title: '',
	picUrl: '',
	isbn: '',
	price: 0.0,
	categoryId: '',
	subjectIds: [],
	callNumber: '',
	publisher: '',
	pubCity: '',
	pubCountry: '',
	pubDate: 0,
	pages: 0,
	series: '',
	abstracts: '',
	author: '',
	classification: '',
	coreName: 'BOOK',
	status: 0
});

// ÂìçÂ∫îÂºèÂºïÁî®ÔºåÂ≠òÂÇ®Êü•ËØ¢ÂèÇÊï∞
const queryParams = reactive({
	pageNo: 1,
	pageSize: 10,
	bookId: -1,
	stackId: null,
	barCode: ''
});

// Âõæ‰π¶Áä∂ÊÄÅÂ≠óÂÖ∏
const DictOptions = [
	{
		label: 'ÂèØÂ§ñÂÄü',
		value: 0
	},
	{
		label: 'Â∫ìÂ≠ò‰∏çË∂≥',
		value: 1
	},
	{
		label: 'Â±ïÁ§∫Âõæ‰π¶(‰∏çÂèØÂ§ñÂÄü)',
		value: 2
	},
	{
		label: 'ÈááË¥≠‰∏≠',
		value: 3
	},
	{
		label: '‰∏ãÊû∂',
		value: 4
	},
	{
		label: '‰øÉÈîÄÂ§ÑÁêÜ',
		value: -1
	}
];

// ÂÆö‰πâË°åÊï∞ÊçÆÁ±ªÂûã
type RowData = {
	id: number;
	bookId: number;
	stackId: number;
	barCode: string;
	location: string;
	status: number;
	createTime: Date;
	stack: [id: number, name: number];
};

// ÂàóÈÖçÁΩÆ
const columns: DataTableColumns<RowData> = [
	{key: 'callNumber', title: 'Á¥¢‰π¶Âè∑', align: 'center', width: 100},
	{key: 'barCode', title: 'Êù°ÂΩ¢Á†Å', align: 'center', width: 100},
	{key: 'stack.name', title: 'È¶ÜËóèÂú∞ÂùÄ', align: 'center', width: 80},
	{
		key: 'location',
		title: 'ËØ¶ÁªÜÂú∞ÂùÄ',
		align: 'center',
		width: 100,
		render: (row: any) => {
			return row.location ? (
				row.location
			) : (
				<t-tag theme="warning" variant="outline">
					ÊöÇÊó†‰ø°ÊÅØ
				</t-tag>
			);
		}
	},
	{
		key: 'status',
		title: 'Âõæ‰π¶Áä∂ÊÄÅ',
		align: 'center',
		width: 50,
		render: (row: any) => {
			const statusMappings = {
				'-1': {text: '‰øÉÈîÄÂ§ÑÁêÜ‰∏≠', theme: 'danger'},
				'3': {text: 'ÈááË¥≠‰∏≠', theme: 'primary', variant: 'light'},
				'4': {text: '‰∏ãÊû∂', theme: 'danger', variant: 'light-outline'},
				'2': {text: 'Â±ïÁ§∫Âõæ‰π¶(ÊöÇ‰∏çÂ§ñÂÄü)', theme: 'success'},
				'1': {text: 'Â§ñÂÄü‰∏≠', theme: 'warning'},
				'0': {text: 'Âú®Êû∂', theme: 'primary'},
				default: {text: 'Êú™Áü•Áä∂ÊÄÅ', theme: 'danger', variant: 'light-outline'}
			};
			// @ts-ignore
			const statusInfo = statusMappings[row.status] || statusMappings.default;
			return (
				<t-tag theme={statusInfo.theme} variant={statusInfo.variant}>
					{statusInfo.text}
				</t-tag>
			);
		}
	},
	{
		key: 'createTime',
		title: 'ÂàõÂª∫Êó∂Èó¥',
		align: 'center',
		width: 100,
		render: (row: any) => {
			return formatDate(row.createTime);
		}
	},
	{
		key: 'action',
		title: 'Êìç‰Ωú',
		width: 100,
		align: 'center',
		render: (row: any) => {
			return (
				<NSpace justify={'center'}>
					<NButton
						size={'small'}
						onClick={() => {
							openForm('update', row.id);
						}}
					>
						‰øÆÊîπ
					</NButton>
					<NPopconfirm
						onPositiveClick={() => {
							handleDelete(row.id);
						}}
					>
						{{
							default: () => 'Á°ÆËÆ§Âà†Èô§',
							trigger: () => <NButton size={'small'}>Âà†Èô§</NButton>
						}}
					</NPopconfirm>
				</NSpace>
			);
		}
	}
];

// ÂÆö‰πâÊï∞ÊçÆË°®Ê†ºkey
const rowKey = (rowData: any) => {
	return rowData.id;
};

const pagination = reactive({
	page: queryParams.pageNo, // ÂΩìÂâçÈ°µÊï∞Ôºå‰ΩøÁî®Êü•ËØ¢ÂèÇÊï∞‰∏≠ÁöÑ pageNo
	pageCount: pageCount.value, // ÊÄªÈ°µÊï∞Ôºå‰ΩøÁî®‰πãÂâçÂÆö‰πâÁöÑ pageCount ÂèòÈáè
	pageSize: queryParams.pageSize, // ÊØèÈ°µÊòæÁ§∫ÁöÑÊù°ÁõÆÊï∞Ôºå‰ΩøÁî®Êü•ËØ¢ÂèÇÊï∞‰∏≠ÁöÑ pageSize
	itemCount: 0, // ÊÄªÊù°ÁõÆÊï∞ÔºåÈªòËÆ§‰∏∫ 0ÔºåÈúÄË¶ÅÂú®Ëé∑ÂèñÊï∞ÊçÆÂêéÊõ¥Êñ∞
	pageSizes: [10, 20, 30, 50], // ÂèØÈÄâÁöÑÊØèÈ°µÊù°ÁõÆÊï∞ÈÄâÈ°π
	showSizePicker: true, // ÊòØÂê¶ÊòæÁ§∫ÊØèÈ°µÊù°ÁõÆÊï∞ÈÄâÊã©Âô®
	showQuickJumper: true, // ÊòØÂê¶ÊòæÁ§∫Âø´ÈÄüË∑≥ËΩ¨Âà∞È°µÁ†ÅËæìÂÖ•Ê°Ü

	// ÂâçÁºÄÊñáÊú¨ÂáΩÊï∞ÔºåÊòæÁ§∫ÂÖ±ÊúâÂ§öÂ∞ëÊù°ËÆ∞ÂΩï
	// @ts-ignore
	prefix({itemCount}) {
		return `ÂÖ±Êúâ ${itemCount} Êù°ËÆ∞ÂΩï`;
	},

	// ÂΩìÈ°µÁ†ÅÊîπÂèòÊó∂Ëß¶ÂèëÁöÑÂõûË∞ÉÂáΩÊï∞
	onChange: (page: number) => {
		queryParams.pageNo = page; // Êõ¥Êñ∞Êü•ËØ¢ÂèÇÊï∞‰∏≠ÁöÑÂΩìÂâçÈ°µÊï∞
		getList(); // Ë∞ÉÁî®Ëé∑ÂèñÊï∞ÊçÆÁöÑÂáΩÊï∞
	},

	// ÂΩìÊØèÈ°µÊù°ÁõÆÊï∞ÊîπÂèòÊó∂Ëß¶ÂèëÁöÑÂõûË∞ÉÂáΩÊï∞
	onUpdatePageSize: (pageSize: number) => {
		queryParams.pageSize = pageSize; // Êõ¥Êñ∞Êü•ËØ¢ÂèÇÊï∞‰∏≠ÁöÑÊØèÈ°µÊù°ÁõÆÊï∞
		queryParams.pageNo = 1; // ÈáçÁΩÆÂΩìÂâçÈ°µÊï∞‰∏∫Á¨¨‰∏ÄÈ°µ
		getList(); // Ë∞ÉÁî®Ëé∑ÂèñÊï∞ÊçÆÁöÑÂáΩÊï∞
	}
});

// Ëé∑ÂèñÂ∫ìÂ≠òÊï∞ÊçÆ
const getList = async () => {
	loading.value = true; // ÂºÄÂßãÂä†ËΩΩÊï∞ÊçÆÔºåËÆæÁΩÆ loading ‰∏∫ true
	try {
		const {data} = await InventoryApi.getInventoryPage(queryParams); // Ë∞ÉÁî® API Ëé∑ÂèñÂ∫ìÂ≠òÊï∞ÊçÆ

		// ÂØπËøîÂõûÁöÑÂ∫ìÂ≠òÊï∞ÊçÆËøõË°åÂ§ÑÁêÜÔºåÊõ¥Êñ∞ list ÂìçÂ∫îÂºèÂºïÁî®
		list.value = data.list.map((item: any) => {
			return {
				...item,
				callNumber: formBookData.value.callNumber // Ê∑ªÂä† callNumber Â≠óÊÆµ
			};
		});

		// Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
		pagination.page = queryParams.pageNo;
		pagination.pageSize = queryParams.pageSize;
		pagination.itemCount = data.total;
		pageCount.value = Math.ceil(pagination.itemCount / pagination.pageSize);
	} finally {
		loading.value = false; // Êï∞ÊçÆÂä†ËΩΩÂÆåÊàêÔºåËÆæÁΩÆ loading ‰∏∫ false
	}
};

// Ëé∑ÂèñÂõæ‰π¶ÂàÜÁ±ªÊï∞ÊçÆ
const getCategoryData = async () => {
	const {data} = await CategoryApi.fetchSimpleCategoryList(); // Ë∞ÉÁî® API Ëé∑ÂèñÂõæ‰π¶ÂàÜÁ±ªÊï∞ÊçÆ
	// @ts-ignore
	categoryList.value.push(...handleTree(data)); // Êõ¥Êñ∞ categoryList ÂìçÂ∫îÂºèÂºïÁî®
};

// Ëé∑Âèñ‰∏ªÈ¢òËØçÊï∞ÊçÆ
const getSubjectData = async () => {
	const {data} = await SubjectApi.fetchSimpleSubjectList(); // Ë∞ÉÁî® API Ëé∑Âèñ‰∏ªÈ¢òËØçÊï∞ÊçÆ
	// @ts-ignore
	subjectList.value = data; // Êõ¥Êñ∞ subjectList ÂìçÂ∫îÂºèÂºïÁî®
};

const formBookRules: FormRules = {
	title: [
		{required: true, message: 'ËØ∑ËæìÂÖ•Âõæ‰π¶ÂêçÁß∞', trigger: 'input'},
		{max: 100, message: 'Âõæ‰π¶ÂêçÁß∞ÈïøÂ∫¶Ë∂ÖËøáÊúÄÂ§ßÈôêÂà∂', trigger: 'input'}
	],
	author: [
		{required: true, message: 'ËØ∑ËæìÂÖ•Âõæ‰π¶‰ΩúËÄÖ', trigger: 'input'},
		{max: 50, message: 'Âõæ‰π¶‰ΩúËÄÖÈïøÂ∫¶Ë∂ÖËøáÊúÄÂ§ßÈôêÂà∂', trigger: 'input'}
	],
	isbn: formRules.isbn,
	categoryId: [{type: 'number', required: true, message: 'ËØ∑ÈÄâÊã©Âõæ‰π¶ÂàÜÁ±ª', trigger: ['blur', 'change']}],
	subjectIds: [{type: 'array', required: true, message: 'ËØ∑ÈÄâÊã©Âõæ‰π¶‰∏ªÈ¢òËØç', trigger: ['blur', 'change']}],
	callNumber: [
		{required: true, message: 'ËØ∑ËæìÂÖ•Âõæ‰π¶Á¥¢‰π¶Âè∑', trigger: 'input'},
		{max: 50, message: 'Âõæ‰π¶Á¥¢‰π¶Âè∑ÈïøÂ∫¶Ë∂ÖËøáÊúÄÂ§ßÈôêÂà∂', trigger: 'input'}
	],
	price: [{required: true, type: 'number', message: 'ËØ∑ËæìÂÖ•Âõæ‰π¶‰ª∑Ê†º', trigger: 'input'}],
	classification: [{required: true, message: 'ËØ∑ËæìÂÖ•Âõæ‰π¶‰∏≠ÂõæÂàÜÁ±ª', trigger: 'input'}]
};

async function handleSubmitBook() {
	if (!formRef.value) return;
	// Ê†°È™åË°®ÂçïÊï∞ÊçÆÔºåÂ¶ÇÊûúÈ™åËØÅ‰∏çÈÄöËøáÔºåÂàô‰∏çÊâßË°åÂêéÁª≠Êìç‰Ωú
	await formRef.value?.validate();
	// Êèê‰∫§Ë°®Âçï
	if (isSubmit.value === false) {
		// Ê∑ªÂä†Âõæ‰π¶
		formLoading.value = true;
		try {
			// ‰ªéË°®Âçï‰∏≠Ëé∑ÂèñÊï∞ÊçÆÂπ∂ËΩ¨Êç¢‰∏∫Êé•Âè£ÈúÄË¶ÅÁöÑÊï∞ÊçÆÊ†ºÂºè
			const param = formBookData.value as unknown as BookApi.BookSkuVO;
			// ÂèëÈÄÅ API ËØ∑Ê±Ç‰ª•ÂàõÂª∫Âõæ‰π¶
			const {data} = await BookApi.createBookSku(param);
			if (data) {
				window.$message?.success(`Ê∑ªÂä†Âõæ‰π¶ "${formBookData.value.title}" ÊàêÂäü`);
				// @ts-ignore
				formBookData.value.id = data;
				current.value++;
				isSubmit.value = true;
			}
		} finally {
			formLoading.value = false;
		}
	} else if (isSubmit.value === true) {
		// Êõ¥Êñ∞Âõæ‰π¶
		formLoading.value = true;
		try {
			// ‰ªéË°®Âçï‰∏≠Ëé∑ÂèñÊï∞ÊçÆÂπ∂ËΩ¨Êç¢‰∏∫Êé•Âè£ÈúÄË¶ÅÁöÑÊï∞ÊçÆÊ†ºÂºè
			const param = formBookData.value as unknown as BookApi.BookSkuVO;
			const {data} = await BookApi.updateBookSku(param);
			if (data === true) {
				window.$message?.success('Êõ¥Êñ∞Âõæ‰π¶‰ø°ÊÅØÊàêÂäü');
			}
		} finally {
			formLoading.value = false;
		}
	}
}

import {useTabStore} from '@/store';

const tab = useTabStore();

function backPage() {
	tab.removeTab('/book/bookCreate');
}

// ==================== ÂºπÁ™óÁõ∏ÂÖ≥ ====================
const formStackRef = ref<HTMLElement & FormInst>(); // Ë°®ÂçïÁöÑÂºïÁî®
const formStackData = ref({
	id: undefined,
	bookId: 0,
	barCode: '',
	stackId: undefined,
	location: '',
	status: 0
});

/**
 * ÂºÇÊ≠•ÂáΩÊï∞ÔºöËé∑ÂèñÈ¶ÜËóèÂú∞ÂùÄÊï∞ÊçÆ
 */
const getStackData = async () => {
	try {
		// ‰ªé API Ëé∑ÂèñÁÆÄÂåñÁöÑÈ¶ÜËóèÂú∞ÂùÄÂàóË°®Êï∞ÊçÆ
		const {data} = await StackApi.fetchSimpleStackList();
		// Â∞ÜËé∑ÂèñÁöÑÊï∞ÊçÆËµãÂÄºÁªô stackList ÂèòÈáèÔºåÁî®‰∫éÂ±ïÁ§∫È¶ÜËóèÂú∞ÂùÄÈÄâÈ°π
		// @ts-ignore
		stackList.value = data;
	} catch (error) {
		console.error('Ëé∑ÂèñÈ¶ÜËóèÂú∞ÂùÄÊï∞ÊçÆÂ§±Ë¥•:', error);
	}
};

/**
 * ÂºÇÊ≠•ÂáΩÊï∞ÔºöÊâìÂºÄÂõæ‰π¶Â∫ìÂ≠ò‰ø°ÊÅØË°®Âçï
 * @param {string} type - Ë°®ÂçïÁ±ªÂûãÔºö'create' - Êñ∞Â¢ûÔºõ'update' - ‰øÆÊîπ
 * @param {number} id - Âõæ‰π¶Â∫ìÂ≠ò‰ø°ÊÅØÁöÑ IDÔºà‰ªÖÂú®‰øÆÊîπÊó∂ÊúâÊïàÔºâ
 */
async function openForm(type: string, id?: number) {
	// ËÆæÁΩÆË°®ÂçïÁ±ªÂûã
	formType.value = type;
	// ÊòæÁ§∫Ë°®Âçï
	formShow.value = true;

	if (type === 'update') {
		// Â¶ÇÊûúÊòØ‰øÆÊîπÊìç‰ΩúÔºåÂä†ËΩΩÊï∞ÊçÆ‰πãÂâçÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
		formLoading.value = true;
		try {
			// ‰ªé API Ëé∑ÂèñÊåáÂÆöÂõæ‰π¶Â∫ìÂ≠ò‰ø°ÊÅØ
			// @ts-ignore
			const {data} = await InventoryApi.getInventory(id);
			// Â∞ÜËé∑ÂèñÁöÑÊï∞ÊçÆËµãÂÄºÁªô formStackData ÂèòÈáèÔºåÁî®‰∫éË°®ÂçïÁöÑÂ°´ÂÖÖ
			// @ts-ignore
			formStackData.value = data;
		} finally {
			// Âä†ËΩΩÁä∂ÊÄÅÁªìÊùü
			formLoading.value = false;
		}
	}

	try {
		// Ëé∑ÂèñÈ¶ÜËóèÂú∞ÂùÄÊï∞ÊçÆ
		await getStackData();
	} catch (error) {
		console.error('Ëé∑ÂèñÈ¶ÜËóèÂú∞ÂùÄÊï∞ÊçÆÂ§±Ë¥•:', error);
	}
}

/**
 * ÂºÇÊ≠•ÂáΩÊï∞ÔºöÊèê‰∫§Ë°®ÂçïÊï∞ÊçÆ
 */
async function submitFrom() {
	// Ê£ÄÊü• formStackRef ÊòØÂê¶Â≠òÂú®ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®ÂàôËøîÂõû
	if (!formStackRef.value) return;

	// Ê†°È™åË°®ÂçïÊï∞ÊçÆÔºåÂ¶ÇÊûúÈ™åËØÅ‰∏çÈÄöËøáÔºåÂàô‰∏çÊâßË°åÂêéÁª≠Êìç‰Ωú
	await formStackRef.value?.validate();

	// ÂºÄÂßãÊèê‰∫§Ë°®ÂçïÊï∞ÊçÆÔºåÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
	formLoading.value = true;
	try {
		// Â∞ÜË°®ÂçïÊï∞ÊçÆËΩ¨Êç¢‰∏∫Êé•Âè£ÈúÄË¶ÅÁöÑÊ†ºÂºè
		// @ts-ignore
		formStackData.value.bookId = formBookData.value.id;
		const param = formStackData.value as unknown as InventoryApi.InventoryVO;

		if (formType.value === 'create') {
			// ÂèëÈÄÅ API ËØ∑Ê±Ç‰ª•ÂàõÂª∫Â∫ìÂ≠òËÆ∞ÂΩï
			// @ts-ignore
			const {data} = await InventoryApi.createInventory(param);
			if (data) {
				window.$message?.success('Ê∑ªÂä†ÊàêÂäü');
			}
		} else if (formType.value === 'update') {
			// ÂèëÈÄÅ API ËØ∑Ê±Ç‰ª•Êõ¥Êñ∞Â∫ìÂ≠òËÆ∞ÂΩï
			const {data} = await InventoryApi.updateInventory(param);
			if (data === true) {
				window.$message?.success('‰øÆÊîπÊàêÂäü');
			}
		}

		// Êìç‰ΩúÂÆåÊàêÂêéÂÖ≥Èó≠ÂºπÁ™óÔºåÂπ∂Âà∑Êñ∞ÂàÜÁ±ªÂàóË°®ÂíåÂ∫ìÂ≠òÊï∞ÊçÆÂàóË°®
		formStackClose();
		await getCategoryData();
		await getList();
	} finally {
		// ‰∏çÁÆ°ÊòØÂê¶ÊàêÂäüÔºåÁªìÊùüÂä†ËΩΩÁä∂ÊÄÅ
		formLoading.value = false;
	}
}

/**
 * ÂáΩÊï∞ÔºöÂÖ≥Èó≠Â∫ìÂ≠ò‰ø°ÊÅØË°®Âçï
 */
const formStackClose = () => {
	// ÈöêËóèË°®Âçï
	formShow.value = false;

	// ÈáçÁΩÆË°®ÂçïÊï∞ÊçÆ‰∏∫ÂàùÂßãÂÄº
	formStackData.value = {
		id: undefined,
		bookId: -1,
		barCode: '',
		stackId: undefined,
		location: '',
		status: 0
	};
};


// Âà†Èô§ÊåâÈíÆÊìç‰Ωú
const handleDelete = async (id: number) => {
	try {
		window.$dialog?.info({
			title: 'Á≥ªÁªüÊèêÁ§∫',
			content: 'ÊòØÂê¶Á°ÆËÆ§Âà†Èô§Êï∞ÊçÆÈ°π',
			positiveText: 'Á°ÆÂÆö',
			negativeText: 'ÂèñÊ∂à',
			onPositiveClick: async () => {
				await InventoryApi.deleteInventoryPage(id);
				await getList();
				window.$message?.success('Âà†Èô§ÊàêÂäü');
			}
		});
	} catch (error) {
		console.log(error);
	}
};

import {localStg} from '@/utils';
import {formatDate} from '@/utils/common/formatTime'; // ÂØºÂÖ•Ê†ºÂºèÂåñÊó∂Èó¥ÁöÑÂáΩÊï∞
import * as StackApi from '@/service/api/stack'; // ÂØºÂÖ•È¶ÜËóèÂú∞ÂùÄÁõ∏ÂÖ≥ÁöÑ API Ë∞ÉÁî®
import * as SubjectApi from '@/service/api/subject'; // ÂØºÂÖ•‰∏ªÈ¢òËØçÁõ∏ÂÖ≥ÁöÑ API Ë∞ÉÁî®
import * as CategoryApi from '@/service/api/category'; // ÂØºÂÖ•Âõæ‰π¶ÂàÜÁ±ªÁõ∏ÂÖ≥ÁöÑ API Ë∞ÉÁî®
import {handleTree} from '@/utils/common/tree'; // ÂØºÂÖ•Â§ÑÁêÜÊ†ëÁä∂Êï∞ÊçÆÁöÑÂ∑•ÂÖ∑ÂáΩÊï∞
import download from '@/utils/common/download'; // ÂØºÂÖ•Êñá‰ª∂‰∏ãËΩΩÁöÑÂ∑•ÂÖ∑ÂáΩÊï∞
import * as BookApi from '@/service/api/bookSku'; // ÂØºÂÖ•Âõæ‰π¶ SKU Áõ∏ÂÖ≥ÁöÑ API Ë∞ÉÁî®
import * as InventoryApi from '@/service/api/inventory'; // ÂØºÂÖ•Â∫ìÂ≠òÁõ∏ÂÖ≥ÁöÑ API Ë∞ÉÁî®
import {getServiceEnvConfig} from '~/.env-config'; // ÂØºÂÖ•Ëé∑ÂèñÁéØÂ¢ÉÈÖçÁΩÆÁöÑÂáΩÊï∞
// ‰∏ä‰º†ÂºπÁ™óÁöÑÊòæÁ§∫Áä∂ÊÄÅ
const uploadShow = ref(false);

// ‰∏ä‰º† Header Â§¥
const uploadHeaders = ref();

// Ëé∑ÂèñÁéØÂ¢ÉÈÖçÁΩÆ‰∏≠ÁöÑ URL
const {url} = getServiceEnvConfig(import.meta.env);

// ‰∏ä‰º†Ë°®ÂçïÁöÑÂºïÁî®
const uploadRef = ref();

// ‰∏ä‰º†Ë°®ÂçïÂä†ËΩΩÁä∂ÊÄÅ
const uploadFormLoading = ref(false);

// ‰∏ä‰º†ÁöÑÂú∞ÂùÄ
const importUrl = `${url}/library/inventory/import`;

// ÊòØÂê¶Êõ¥Êñ∞Â∑≤ÁªèÂ≠òÂú®ÁöÑÊï∞ÊçÆ
const updateSupport = ref(0);

// Â§ÑÁêÜÂØºÂÖ•ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
const handleImport = () => {
	// ËÆæÁΩÆ‰∏ä‰º†ËØ∑Ê±ÇÁöÑ Header Â§¥
	uploadHeaders.value = {
		Authorization: `Bearer ${localStg.get('accessToken')}`,
		'tenant-id': localStg.get('tenantId')
	};

	// ÊòæÁ§∫‰∏ä‰º†ÂºπÁ™ó
	uploadShow.value = true;
};

// ÂàõÂª∫‰∏Ä‰∏™Áî®‰∫éÊòæÁ§∫Â§ÑÁêÜ‰∏≠Ê∂àÊÅØÁöÑ MessageReactive ÂÆû‰æã
let msgReactive: MessageReactive | null = null;

// Êèê‰∫§‰∏ä‰º†Ë°®Âçï
const submitUploadForm = async () => {
	// ËÆæÁΩÆË°®ÂçïÂä†ËΩΩÁä∂ÊÄÅ
	uploadFormLoading.value = true;

	// ÂàõÂª∫‰∏Ä‰∏™Âä†ËΩΩ‰∏≠Ê∂àÊÅØ
	// @ts-ignore
	msgReactive = window.$message?.create('Êï∞ÊçÆÂ§ÑÁêÜ‰∏≠...ËØ∑Á®çÂêé', {
		type: 'loading',
		keepAliveOnHover: true
	});

	// Ë∞ÉÁî®‰∏ä‰º†Ë°®ÂçïÁöÑ submit ÊñπÊ≥ï
	uploadRef.value?.submit();
};

/**
 * ‰∏ä‰º†ÈîôËØØÊèêÁ§∫
 */
const submitFormError = (): void => {
	window.$message?.error('‰∏ä‰º†Â§±Ë¥•ÔºåËØ∑ÊÇ®ÈáçÊñ∞‰∏ä‰º†ÔºÅ');
	uploadFormLoading.value = false;
};

/**
 * ‰∏ä‰º†ÊàêÂäüÂõûË∞ÉÂáΩÊï∞
 * @param response - ‰∏ä‰º†ÊàêÂäüÁöÑÂìçÂ∫î
 */
const submitFormSuccess = (response: any) => {
	// Ëß£ÊûêÂìçÂ∫î‰∏∫ JSON ÂØπË±°
	const res = JSON.parse(response.event.target.response);

	// Â¶ÇÊûúÂìçÂ∫îÁöÑÁä∂ÊÄÅÁ†Å‰∏çÊòØ 200ÔºåÂàôÊòæÁ§∫ÈîôËØØÊ∂àÊÅØ
	if (res.code !== 200) {
		window.$message?.error(res.msg);
		uploadFormLoading.value = false;
		return;
	}

	// ËÆæÁΩÆÊ∂àÊÅØ‰∏∫ÊàêÂäüÁ±ªÂûã
	// @ts-ignore
	msgReactive.type = 'success';
	// @ts-ignore
	msgReactive.content = 'ÂØºÂÖ•ÊàêÂäü';

	// ÊãºÊé•‰∏ä‰º†ÂõûÊâßÁöÑÊèêÁ§∫‰ø°ÊÅØ
	const data = res.data;
	let text = `‰∏ä‰º†ÊàêÂäüÊï∞ÈáèÔºö${data.createNames.length};`;
	for (const name of data.createNames) {
		text += `< ${name} >`;
	}
	text += `Êõ¥Êñ∞ÊàêÂäüÊï∞ÈáèÔºö${data.updateNames.length};`;
	for (const name of data.updateNames) {
		text += `< ${name} >`;
	}
	text += `Êõ¥Êñ∞Â§±Ë¥•Êï∞ÈáèÔºö${Object.keys(data.failureNames).length};`;
	for (const name in data.failureNames) {
		text += `< ${name}: ${data.failureNames[name]} >`;
	}

	// ÂàõÂª∫‰∏Ä‰∏™ÈÄöÁü•ÂÆû‰æãÊòæÁ§∫ÂØºÂÖ•ÂõûÊâß‰ø°ÊÅØ
	const n = window.$notification?.create({
		title: 'ÂØºÂÖ•ÂõûÊâß',
		content: text,
		meta: () => h(NTime),
		action: () =>
			h(
				NButton,
				{
					text: true,
					type: 'primary',
					onClick: () => {
						// ÂÖ≥Èó≠ÈÄöÁü•
						// @ts-ignore
						n.destroy();
					}
				},
				{
					default: () => 'Â∑≤ËØª'
				}
			)
	});

	// ÂÖ≥Èó≠‰∏ä‰º†ÂºπÁ™ó
	closeUploadForm();
};

/**
 * ÂÖ≥Èó≠‰∏ä‰º†ÂºπÁ™óÂπ∂ÈáçÁΩÆÁä∂ÊÄÅ
 */
async function closeUploadForm() {
	uploadShow.value = false;
	uploadFormLoading.value = false;
	updateSupport.value = 0;
	// Âà∑Êñ∞Êï∞ÊçÆÂàóË°®ÂíåÂõæ‰π¶‰ø°ÊÅØ
	await getList();
}

/**
 * ‰∏ãËΩΩÂØºÂÖ•Ê®°ÊùøÊìç‰Ωú
 */
const importTemplate = async () => {
	// ÂèëËµ∑‰∏ãËΩΩÊ®°ÊùøËØ∑Ê±Ç
	const res = await InventoryApi.importInventoryTemplate();

	// ÊòæÁ§∫‰∏ãËΩΩÊèêÁ§∫‰ø°ÊÅØ
	window.$message?.info('Ê≠£Âú®‰∏ãËΩΩÊ®°ÊùøÔºåËØ∑Á®çÁ≠â...');

	// ‰ΩøÁî® download.excel ÂáΩÊï∞‰∏ãËΩΩ Excel Êñá‰ª∂
	// @ts-ignore
	download.excel(res, 'Â∫ìÂ≠òÂØºÂÖ•Ê®°Êùø.xls');
};

// Âú®ÁªÑ‰ª∂ÊåÇËΩΩÊó∂Ëé∑ÂèñÂàóË°®Êï∞ÊçÆ
onMounted(async () => {
	// Ëé∑ÂèñÂõæ‰π¶Êï∞ÊçÆ„ÄÅÂàÜÁ±ªÊï∞ÊçÆ„ÄÅ‰∏ªÈ¢òÊï∞ÊçÆÂíåÂàóË°®Êï∞ÊçÆ
	await getCategoryData();
	await getSubjectData();
	await getList();
});
</script>

<style scoped></style>
